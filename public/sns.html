<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SNS Topics</title>
    <style>
      /* Navigation Bar Styles */
      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 60px;
        background: #1e293b;
        color: white;
        display: flex;
        align-items: center;
        padding: 0 20px;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      
      .navbar-brand {
        font-size: 18px;
        font-weight: 600;
        margin-right: 40px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .home-icon {
        font-size: 20px;
        color: #fbbf24;
        text-decoration: none;
        transition: transform 0.2s;
      }
      
      .home-icon:hover {
        transform: scale(1.1);
      }
      
      .navbar-nav {
        display: flex;
        list-style: none;
        margin: 0;
        padding: 0;
        gap: 20px;
      }
      
      .navbar-nav a {
        color: #cbd5e1;
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 6px;
        transition: all 0.2s;
        font-weight: 500;
      }
      
      .navbar-nav a:hover {
        color: white;
        background: rgba(255, 255, 255, 0.1);
      }
      
      .navbar-nav a.active {
        color: white;
        background: #2563eb;
      }
      
      /* Adjust body to account for navbar */
      body { 
        font-family: Arial, sans-serif; 
        margin:0; 
        padding:0; 
        display:flex; 
        height:100vh; 
        padding-top: 60px; /* Add top padding for navbar */
      }
      
      #sidebar{position:relative;width:350px;min-width:180px;max-width:600px;background:#f8fafc;overflow:auto;border-right:1px solid #e2e8f0;box-shadow:2px 0 4px rgba(0,0,0,0.05);} 
      #resizer{width:5px;cursor:col-resize;background:transparent;}#resizer:hover{background:rgba(0,0,0,.1);} 
      #content{flex:1;padding:20px;overflow-y:auto;}
      .topic{padding:10px 12px;cursor:pointer;margin:4px 6px;border-radius:6px;transition:background .15s;color:#1e293b;font-weight:500;}
      .topic:hover{background:#e5e7eb;}
      .topic.active{background:#2563eb;color:#fff;}
      .topic-header{font-size:12px;font-weight:600;padding:6px 12px 4px;color:#475569;margin:4px 6px 0;border-bottom:1px solid #e2e8f0;}
      #search{border:1px solid #cbd5e1;border-radius:6px;outline:none;width:90%;margin:10px;padding:6px;}#search:focus{border-color:#2563eb;box-shadow:0 0 0 2px rgba(37,99,235,.2)}
      table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.05);}th,td{border:none;padding:12px 16px;}th{background:#f3f4f6;text-align:left;font-weight:600}tbody tr:not(:last-child) td{border-bottom:1px solid #e5e7eb}
      td.readonly{background:#f9f9f9;}
    </style>
  </head>
  <body>
    <div class="navbar">
      <div class="navbar-brand">
        <a href="/" class="home-icon">üè†</a>
        LocalStack Explorer
      </div>
      <nav>
        <ul class="navbar-nav">
          <li><a href="/sqs.html" class="navbar-nav-link">SQS</a></li>
          <li><a href="/sns.html" class="navbar-nav-link active">SNS</a></li>
        </ul>
      </nav>
    </div>
    <div id="sidebar">
      <h2 style="padding:10px;margin:0;">SNS Topics</h2>
      <input id="search" placeholder="Search..." />
      <div class="topic-header">Topic Name</div>
      <div id="topics"></div>
    </div>
    <div id="resizer"></div>
    <div id="content">
      <h2 id="topicTitle" style="margin-top:0;display:none;"></h2>
      <div id="attrPlaceholder">Select a topic to view its attributes</div>
      <table id="attrTable" style="display:none;"><thead><tr><th>Attribute</th><th>Value</th></tr></thead><tbody></tbody></table>
      <div id="subsSection" style="display:none;margin-top:24px;">
        <h3 style="margin:0 0 8px 0;">Subscribed SQS Queues</h3>
        <ul id="sqsSubs" style="padding-left:18px;margin:0;"></ul>
      </div>
    </div>

    <script>
      let allTopics = [];
      let selectedArn = null;

      function renderTopics(filter=''){
        const list = document.getElementById('topics');
        list.innerHTML='';
        const lFilter = filter.toLowerCase();
        allTopics.filter(arn=>arn.toLowerCase().includes(lFilter)).forEach(arn=>{
          const name = arn.split(':').pop();
          const div = document.createElement('div');
          div.className='topic';
          div.textContent=name;
          div.title=arn;
          div.onclick=()=>loadAttributes(arn);
          if(arn===selectedArn) div.classList.add('active');
          list.appendChild(div);
        });
      }

      async function loadTopics(){
        try{
          const res = await fetch('/api/sns');
          const data = await res.json();
          allTopics = data.topics || [];
          renderTopics(document.getElementById('search').value);
        }catch(err){console.error('Failed to load topics',err);}
      }

      async function loadAttributes(arn){
        try{
          const res = await fetch('/api/topic?arn='+encodeURIComponent(arn));
          const data = await res.json();
          selectedArn = arn;
          document.querySelectorAll('.topic.active').forEach(el=>el.classList.remove('active'));
          const active = Array.from(document.querySelectorAll('.topic')).find(el=>el.title===arn);
          if(active) active.classList.add('active');

          // set title
          const title = document.getElementById('topicTitle');
          title.textContent = arn.split(':').pop();
          title.style.display='block';

          const table = document.getElementById('attrTable');
          const tbody = table.querySelector('tbody');
          tbody.innerHTML='';
          Object.entries(data.attributes || {}).forEach(([k,v])=>{
            const tr=document.createElement('tr');
            const tdK=document.createElement('td');tdK.textContent=k;
            const tdV=document.createElement('td');tdV.textContent=v;tr.appendChild(tdK);tr.appendChild(tdV);tbody.appendChild(tr);
          });
          document.getElementById('attrPlaceholder').style.display='none';
          table.style.display='table';

          // Fetch and show SQS subscriptions
          const subsSection = document.getElementById('subsSection');
          const subsList = document.getElementById('sqsSubs');
          subsList.innerHTML = '';
          subsSection.style.display = 'none';
          try {
            const subsRes = await fetch('/api/topic-sqs-subs?arn='+encodeURIComponent(arn));
            const subsData = await subsRes.json();
            if (subsData.sqs && subsData.sqs.length > 0) {
              subsData.sqs.forEach(sub => {
                const li = document.createElement('li');
                li.textContent = sub.Endpoint;
                subsList.appendChild(li);
              });
              subsSection.style.display = 'block';
            }
          } catch (e) {
            // ignore error, just hide section
          }
        }catch(err){console.error('Failed to load attr',err);}
      }

      document.getElementById('search').addEventListener('input',e=>{renderTopics(e.target.value)});

      // resizer
      (function(){
        const sidebar=document.getElementById('sidebar');
        const resizer=document.getElementById('resizer');
        let startX,startW;const MIN=180,MAX=600;
        function move(e){let w=startW+(e.clientX-startX);w=Math.max(MIN,Math.min(MAX,w));sidebar.style.width=w+'px';}
        function up(){document.removeEventListener('mousemove',move);document.removeEventListener('mouseup',up);document.body.style.userSelect='';}
        resizer.addEventListener('mousedown',e=>{startX=e.clientX;startW=sidebar.offsetWidth;document.body.style.userSelect='none';document.addEventListener('mousemove',move);document.addEventListener('mouseup',up);});
      })();

      loadTopics();
      setInterval(loadTopics,30000);
    </script>
  </body>
</html> 